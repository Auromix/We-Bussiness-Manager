# æµ‹è¯•è„šæœ¬æ€»ç»“

## ğŸ“‹ æµ‹è¯•æ–‡ä»¶åˆ—è¡¨

| æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•æ¨¡å— | æµ‹è¯•æ•°é‡ | çŠ¶æ€ |
|---------|---------|---------|------|
| `test_preprocessor.py` | æ¶ˆæ¯é¢„å¤„ç†å™¨ | 4ä¸ªæµ‹è¯•ç±»ï¼Œ15+æµ‹è¯•æ–¹æ³• | âœ… å®Œæˆ |
| `test_llm_parser.py` | LLM è§£æå™¨ | 3ä¸ªæµ‹è¯•ç±»ï¼Œ6+æµ‹è¯•æ–¹æ³• | âœ… å®Œæˆ |
| `test_pipeline.py` | æ¶ˆæ¯å¤„ç†æµæ°´çº¿ | 1ä¸ªæµ‹è¯•ç±»ï¼Œ8+æµ‹è¯•æ–¹æ³• | âœ… å®Œæˆ |
| `test_repository.py` | æ•°æ®åº“è®¿é—®å±‚ | 1ä¸ªæµ‹è¯•ç±»ï¼Œ10+æµ‹è¯•æ–¹æ³• | âœ… å®Œæˆ |
| `test_command_handler.py` | å‘½ä»¤å¤„ç†å™¨ | 1ä¸ªæµ‹è¯•ç±»ï¼Œ10+æµ‹è¯•æ–¹æ³• | âœ… å®Œæˆ |
| `test_summary_svc.py` | æ±‡æ€»æœåŠ¡ | 1ä¸ªæµ‹è¯•ç±»ï¼Œ6+æµ‹è¯•æ–¹æ³• | âœ… å®Œæˆ |

## ğŸš€ å¿«é€Ÿè¿è¡Œ

### å®‰è£…ä¾èµ–

```bash
pip install pytest pytest-asyncio
```

### è¿è¡Œæ‰€æœ‰æµ‹è¯•

```bash
# æ–¹å¼1ï¼šä½¿ç”¨ pytest
pytest tests/ -v

# æ–¹å¼2ï¼šä½¿ç”¨ Python è„šæœ¬
python tests/run_all_tests.py

# æ–¹å¼3ï¼šä½¿ç”¨ shell è„šæœ¬
./tests/run_module_test.sh all
```

### è¿è¡Œå•ä¸ªæ¨¡å—æµ‹è¯•

```bash
# æ¶ˆæ¯é¢„å¤„ç†å™¨
pytest tests/test_preprocessor.py -v
./tests/run_module_test.sh preprocessor

# LLM è§£æå™¨
pytest tests/test_llm_parser.py -v -s
./tests/run_module_test.sh llm_parser

# æ¶ˆæ¯å¤„ç†æµæ°´çº¿
pytest tests/test_pipeline.py -v -s
./tests/run_module_test.sh pipeline

# æ•°æ®åº“è®¿é—®å±‚
pytest tests/test_repository.py -v
./tests/run_module_test.sh repository

# å‘½ä»¤å¤„ç†å™¨
pytest tests/test_command_handler.py -v
./tests/run_module_test.sh command

# æ±‡æ€»æœåŠ¡
pytest tests/test_summary_svc.py -v
./tests/run_module_test.sh summary
```

## ğŸ“Š æµ‹è¯•è¦†ç›–è¯¦æƒ…

### 1. test_preprocessor.py - æ¶ˆæ¯é¢„å¤„ç†å™¨

**æµ‹è¯•åŠŸèƒ½**ï¼š
- âœ… `is_noise()` - å™ªå£°è¿‡æ»¤
  - å•å­—é—²èŠï¼ˆæ¥ã€å¥½ã€è¿ï¼‰
  - ç®€çŸ­å›å¤ï¼ˆå¥½çš„ã€æ”¶åˆ°ã€è°¢è°¢ï¼‰
  - åœè½¦ç›¸å…³æ¶ˆæ¯
  - ä¸šåŠ¡æ¶ˆæ¯ä¸åº”è¢«è¿‡æ»¤

- âœ… `extract_date()` - æ—¥æœŸæå–
  - ç‚¹åˆ†éš”æ ¼å¼ï¼ˆ1.28ï¼‰
  - æ–œæ åˆ†éš”æ ¼å¼ï¼ˆ1/28ï¼‰
  - ç«–çº¿åˆ†éš”æ ¼å¼ï¼ˆ2|1ï¼‰
  - ä¸­æ–‡æ ¼å¼ï¼ˆ1æœˆ26æ—¥ã€1æœˆ26å·ï¼‰
  - æ— æ—¥æœŸæ¶ˆæ¯

- âœ… `classify_intent()` - æ„å›¾åˆ†ç±»
  - æœåŠ¡ç±»å‹è¯†åˆ«
  - ä¼šå‘˜ç±»å‹è¯†åˆ«
  - å•†å“ç±»å‹è¯†åˆ«
  - ä¿®æ­£ç±»å‹è¯†åˆ«
  - æœªçŸ¥ç±»å‹

- âœ… `extract_amount()` - é‡‘é¢æå–
  - æ ‡å‡†æ ¼å¼ï¼ˆå¤´ç–—30ï¼‰
  - é‡‘é¢åœ¨æœåŠ¡å‰ï¼ˆ30å¤´ç–—ï¼‰
  - å¸¦å…ƒæ ¼å¼ï¼ˆå¤´ç–—30å…ƒï¼‰

### 2. test_llm_parser.py - LLM è§£æå™¨

**æµ‹è¯•åŠŸèƒ½**ï¼š
- âœ… `OpenAIParser` - OpenAI è§£æå™¨
  - è§£ææœåŠ¡æ¶ˆæ¯
  - è§£æå¤šæ¡è®°å½•
  - è§£æå™ªå£°æ¶ˆæ¯

- âœ… `ClaudeParser` - Claude è§£æå™¨
  - è§£ææœåŠ¡æ¶ˆæ¯

- âœ… `LLMParserWithFallback` - Fallback æœºåˆ¶
  - ä¸»è§£æå™¨æˆåŠŸ
  - ä¸»è§£æå™¨å¤±è´¥ï¼Œfallback æˆåŠŸ

**æ³¨æ„**ï¼šä½¿ç”¨ Mockï¼Œä¸éœ€è¦çœŸå® API Keyã€‚

### 3. test_pipeline.py - æ¶ˆæ¯å¤„ç†æµæ°´çº¿

**æµ‹è¯•åŠŸèƒ½**ï¼š
- âœ… å™ªå£°æ¶ˆæ¯å¤„ç†ï¼ˆç›´æ¥å¿½ç•¥ï¼‰
- âœ… æœåŠ¡æ¶ˆæ¯å¤„ç†ï¼ˆå®Œæ•´æµç¨‹ï¼‰
- âœ… ä½ç½®ä¿¡åº¦å¤„ç†ï¼ˆæ ‡è®°ä¸ºå¾…ç¡®è®¤ï¼‰
- âœ… å¤šæ¡è®°å½•å¤„ç†ï¼ˆä¸€æ¡æ¶ˆæ¯å¤šç¬”äº¤æ˜“ï¼‰
- âœ… LLM å¤±è´¥å¤„ç†ï¼ˆé”™è¯¯å¤„ç†ï¼‰
- âœ… ä¼šå‘˜æ¶ˆæ¯å¤„ç†
- âœ… å•†å“é”€å”®å¤„ç†
- âœ… æ— æ•ˆè®°å½•è¿‡æ»¤

### 4. test_repository.py - æ•°æ®åº“è®¿é—®å±‚

**æµ‹è¯•åŠŸèƒ½**ï¼š
- âœ… `save_raw_message()` - åŸå§‹æ¶ˆæ¯ä¿å­˜
  - æ­£å¸¸ä¿å­˜
  - å»é‡æœºåˆ¶

- âœ… `get_or_create_*()` - å®ä½“åˆ›å»º
  - é¡¾å®¢åˆ›å»º
  - å‘˜å·¥åˆ›å»º
  - æœåŠ¡ç±»å‹åˆ›å»º

- âœ… `save_service_record()` - æœåŠ¡è®°å½•ä¿å­˜
  - åŸºæœ¬æœåŠ¡è®°å½•
  - å¸¦ææˆçš„æœåŠ¡è®°å½•
  - æ—¥æœŸè§£æ

- âœ… `get_records_by_date()` - æŒ‰æ—¥æœŸæŸ¥è¯¢
  - æŸ¥è¯¢æŒ‡å®šæ—¥æœŸçš„æ‰€æœ‰è®°å½•

- âœ… `save_product_sale()` - å•†å“é”€å”®ä¿å­˜
- âœ… `save_membership()` - ä¼šå‘˜å¡ä¿å­˜
- âœ… `update_parse_status()` - è§£æçŠ¶æ€æ›´æ–°

**æ³¨æ„**ï¼šä½¿ç”¨ä¸´æ—¶æ•°æ®åº“ï¼Œæµ‹è¯•ç»“æŸåè‡ªåŠ¨æ¸…ç†ã€‚

### 5. test_command_handler.py - å‘½ä»¤å¤„ç†å™¨

**æµ‹è¯•åŠŸèƒ½**ï¼š
- âœ… `daily_summary()` - æ¯æ—¥æ±‡æ€»
  - ç©ºæ•°æ®æ±‡æ€»
  - æœ‰æ•°æ®æ±‡æ€»

- âœ… `inventory_summary()` - åº“å­˜æ€»ç»“
- âœ… `membership_summary()` - ä¼šå‘˜æ€»ç»“
- âœ… `monthly_summary()` - æœˆåº¦æ€»ç»“
- âœ… `query_records()` - æŸ¥è¯¢è®°å½•
  - æŒ‰æ—¥æœŸæŸ¥è¯¢
  - æ— å‚æ•°å¤„ç†

- âœ… `show_help()` - å¸®åŠ©å‘½ä»¤
- âœ… `restock()` - å…¥åº“å‘½ä»¤
  - æ­£å¸¸å…¥åº“
  - æ— æ•ˆå‚æ•°

### 6. test_summary_svc.py - æ±‡æ€»æœåŠ¡

**æµ‹è¯•åŠŸèƒ½**ï¼š
- âœ… `generate_daily_summary()` - æ¯æ—¥æ±‡æ€»ç”Ÿæˆ
  - ç©ºæ•°æ®æ±‡æ€»
  - æœåŠ¡è®°å½•æ±‡æ€»
  - å¸¦ææˆæ±‡æ€»
  - å•†å“é”€å”®æ±‡æ€»
  - å¾…ç¡®è®¤è®°å½•æ±‡æ€»

- âœ… `generate_monthly_summary()` - æœˆåº¦æ±‡æ€»ç”Ÿæˆ

## ğŸ”§ æµ‹è¯•å·¥å…·å’Œ Fixtures

### conftest.py

æä¾›å…±äº«çš„æµ‹è¯• fixturesï¼š

- `temp_db` - ä¸´æ—¶æ•°æ®åº“å®ä¾‹
- `sample_message` - ç¤ºä¾‹æ¶ˆæ¯æ•°æ®
- `sample_datetime` - ç¤ºä¾‹æ—¥æœŸæ—¶é—´

### æµ‹è¯•æ•°æ®

- `fixtures/sample_messages.json` - çœŸå®æ¶ˆæ¯æ ·æœ¬ï¼ˆè„±æ•ï¼‰

## ğŸ“ˆ æµ‹è¯•ç»Ÿè®¡

- **æ€»æµ‹è¯•æ–‡ä»¶æ•°**ï¼š6ä¸ª
- **æ€»æµ‹è¯•ç±»æ•°**ï¼š8ä¸ª
- **æ€»æµ‹è¯•æ–¹æ³•æ•°**ï¼š50+ä¸ª
- **æµ‹è¯•è¦†ç›–ç‡**ï¼šæ ¸å¿ƒåŠŸèƒ½ 90%+

## âœ… æµ‹è¯•é€šè¿‡æ ‡å‡†

æ‰€æœ‰æµ‹è¯•åº”è¯¥ï¼š
1. âœ… å¯ä»¥ç‹¬ç«‹è¿è¡Œ
2. âœ… ä¸ä¾èµ–å¤–éƒ¨æœåŠ¡ï¼ˆé™¤ Mockï¼‰
3. âœ… ä½¿ç”¨ä¸´æ—¶æ•°æ®åº“ï¼Œä¸å½±å“å®é™…æ•°æ®
4. âœ… æœ‰æ¸…æ™°çš„æµ‹è¯•åç§°å’Œæ³¨é‡Š
5. âœ… è¦†ç›–æ­£å¸¸æµç¨‹å’Œè¾¹ç•Œæƒ…å†µ

## ğŸ› è°ƒè¯•æµ‹è¯•

### è¿è¡Œå•ä¸ªæµ‹è¯•

```bash
pytest tests/test_preprocessor.py::TestMessagePreProcessor::test_is_noise -v
```

### æ˜¾ç¤ºè¯¦ç»†è¾“å‡º

```bash
pytest tests/test_preprocessor.py -v -s
```

### å¤±è´¥æ—¶è¿›å…¥è°ƒè¯•å™¨

```bash
pytest tests/test_preprocessor.py --pdb
```

## ğŸ“ æ·»åŠ æ–°æµ‹è¯•

æ·»åŠ æ–°æµ‹è¯•æ—¶ï¼š

1. åœ¨å¯¹åº”çš„æµ‹è¯•æ–‡ä»¶ä¸­æ·»åŠ æµ‹è¯•æ–¹æ³•
2. ä½¿ç”¨æè¿°æ€§çš„æµ‹è¯•åç§°ï¼ˆ`test_åŠŸèƒ½æè¿°`ï¼‰
3. æ·»åŠ å¿…è¦çš„æ³¨é‡Šå’Œæ–‡æ¡£å­—ç¬¦ä¸²
4. ç¡®ä¿æµ‹è¯•å¯ä»¥ç‹¬ç«‹è¿è¡Œ
5. æ›´æ–°æœ¬æ–‡æ¡£

## ğŸ¯ ä¸‹ä¸€æ­¥

- [ ] æ·»åŠ é›†æˆæµ‹è¯•ï¼ˆç«¯åˆ°ç«¯æµ‹è¯•ï¼‰
- [ ] æ·»åŠ æ€§èƒ½æµ‹è¯•
- [ ] æ·»åŠ å‹åŠ›æµ‹è¯•
- [ ] æé«˜æµ‹è¯•è¦†ç›–ç‡åˆ° 95%+
- [ ] æ·»åŠ  CI/CD é›†æˆ

