# å¥èº«æˆ¿æ™ºèƒ½ç®¡ç†åŠ©æ‰‹ - MiniMax Agent + æ•°æ®åº“é›†æˆ

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„å¥èº«æˆ¿ç®¡ç†ç³»ç»Ÿç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•å°† MiniMax Agent ä¸æ•°æ®åº“é›†æˆï¼Œå®ç°æ™ºèƒ½åŒ–çš„ä¸šåŠ¡ç®¡ç†ã€‚

## ğŸŒŸ åŠŸèƒ½ç‰¹ç‚¹

- **è‡ªç„¶è¯­è¨€äº¤äº’**ï¼šç»è¥è€…å¯ä»¥ç”¨è‡ªç„¶è¯­è¨€è¾“å…¥ï¼ŒAgent è‡ªåŠ¨ç†è§£å¹¶è°ƒç”¨ç›¸åº”çš„æ•°æ®åº“å‡½æ•°
- **è‡ªåŠ¨è®°è´¦**ï¼šè‡ªåŠ¨è®°å½•ç§æ•™è¯¾ã€å›¢è¯¾ã€ä¼šå‘˜å¡ã€å•†å“é”€å”®ç­‰ä¸šåŠ¡
- **æ™ºèƒ½ææˆè®¡ç®—**ï¼šç§æ•™è¯¾ç¨‹è‡ªåŠ¨è®¡ç®—40%ææˆ
- **æ•°æ®æŸ¥è¯¢**ï¼šæ”¯æŒæŸ¥è¯¢æ—¥æ”¶å…¥ã€ä¼šå‘˜ä¿¡æ¯ã€ç§æ•™ææˆç­‰ç»Ÿè®¡æ•°æ®
- **Interleaved Thinking**ï¼šå±•ç¤º AI çš„æ€è€ƒè¿‡ç¨‹ï¼Œæé«˜é€æ˜åº¦

## ğŸ“¦ åŒ…å«çš„åŠŸèƒ½æ¨¡å—

### 1. æ•°æ®åº“æ“ä½œå‡½æ•°ï¼ˆå¯è¢« Agent è°ƒç”¨ï¼‰

- `record_service_income()` - è®°å½•æœåŠ¡æ”¶å…¥ï¼ˆç§æ•™è¯¾ã€å›¢è¯¾ç­‰ï¼‰
- `open_membership_card()` - å¼€ä¼šå‘˜å¡
- `record_product_sale()` - è®°å½•å•†å“é”€å”®
- `query_daily_income()` - æŸ¥è¯¢æ¯æ—¥æ”¶å…¥ç»Ÿè®¡
- `query_member_info()` - æŸ¥è¯¢ä¼šå‘˜ä¿¡æ¯
- `query_trainer_commission()` - æŸ¥è¯¢ç§æ•™ææˆ

### 2. æ•°æ®åº“è¡¨ç»“æ„

- **employees** - å‘˜å·¥è¡¨ï¼ˆç§æ•™ã€å‰å°ç­‰ï¼‰
- **customers** - é¡¾å®¢è¡¨
- **memberships** - ä¼šå‘˜å¡è¡¨ï¼ˆæ”¯æŒå¹´å¡ã€å­£å¡ã€æœˆå¡ï¼‰
- **service_records** - æœåŠ¡è®°å½•è¡¨
- **product_sales** - å•†å“é”€å”®è¡¨
- **referral_channels** - å¼•æµæ¸ é“è¡¨

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. å®‰è£…ä¾èµ–

```bash
pip install anthropic loguru sqlalchemy
```

### 2. è®¾ç½® API Key

```bash
export MINIMAX_API_KEY="your-api-key"
```

### 3. è¿è¡Œç¤ºä¾‹

```bash
python examples/gym_agent_manager.py
```

### 4. è¿è¡Œæµ‹è¯•

```bash
python tests/agent/test_gym_agent_integration.py
```

æˆ–ä½¿ç”¨ pytestï¼š

```bash
pytest tests/agent/test_gym_agent_integration.py -v
```

## ğŸ“ ä½¿ç”¨åœºæ™¯ç¤ºä¾‹

### åœºæ™¯1ï¼šè®°å½•ç§æ•™è¯¾

**è¾“å…¥ï¼š** "ä»Šå¤©å¼ ä¸‰ä¸Šäº†ææ•™ç»ƒçš„ç§æ•™è¯¾ï¼Œæ”¶è´¹300å…ƒ"

**Agent è¡Œä¸ºï¼š**
- è°ƒç”¨ `record_service_income()` å‡½æ•°
- è‡ªåŠ¨è®¡ç®—ç§æ•™ææˆï¼š300 Ã— 40% = 120å…ƒ
- å‡€æ”¶å…¥ï¼š300 - 120 = 180å…ƒ
- ä¿å­˜åˆ°æ•°æ®åº“

**è¾“å‡ºï¼š**
```
å·²è®°å½• âœ…
- ä¼šå‘˜ï¼šå¼ ä¸‰
- æ•™ç»ƒï¼šææ•™ç»ƒ
- è¯¾ç¨‹æ”¶å…¥ï¼š300å…ƒ
- ç§æ•™ææˆï¼ˆ40%ï¼‰ï¼š120å…ƒ
- å‡€æ”¶å…¥ï¼š180å…ƒ
```

### åœºæ™¯2ï¼šå¼€ä¼šå‘˜å¡

**è¾“å…¥ï¼š** "æå››å¼€äº†ä¸€å¼ å¹´å¡ï¼Œå……å€¼3000å…ƒ"

**Agent è¡Œä¸ºï¼š**
- è°ƒç”¨ `open_membership_card()` å‡½æ•°
- è‡ªåŠ¨è®¡ç®—æœ‰æ•ˆæœŸï¼š365å¤©
- è‡ªåŠ¨è®¡ç®—ç§¯åˆ†ï¼š3000 / 10 = 300åˆ†
- ä¿å­˜åˆ°æ•°æ®åº“

**è¾“å‡ºï¼š**
```
å·²ä¸ºæå››åŠç†å¹´å¡ï¼š
- å¡ç±»å‹ï¼šå¹´å¡ï¼ˆ365å¤©ï¼‰
- å……å€¼é‡‘é¢ï¼š3000å…ƒ
- è·å¾—ç§¯åˆ†ï¼š300åˆ†
- æœ‰æ•ˆæœŸè‡³ï¼š2027-02-17
```

### åœºæ™¯3ï¼šè®°å½•å•†å“é”€å”®

**è¾“å…¥ï¼š** "ç‹äº”ä¹°äº†ä¸€ç“¶è›‹ç™½ç²‰ï¼Œ200å…ƒ"

**Agent è¡Œä¸ºï¼š**
- è°ƒç”¨ `record_product_sale()` å‡½æ•°
- ä¿å­˜å•†å“é”€å”®è®°å½•

### åœºæ™¯4ï¼šæŸ¥è¯¢æ”¶å…¥

**è¾“å…¥ï¼š** "æŸ¥è¯¢ä¸€ä¸‹ä»Šå¤©çš„æ”¶å…¥æƒ…å†µ"

**Agent è¡Œä¸ºï¼š**
- è°ƒç”¨ `query_daily_income()` å‡½æ•°
- ç»Ÿè®¡æœåŠ¡æ”¶å…¥ã€å•†å“æ”¶å…¥ã€ææˆã€å‡€æ”¶å…¥

**è¾“å‡ºï¼š**
```
ä»Šå¤©æ˜¯2026-02-17ï¼Œæ”¶å…¥æƒ…å†µå¦‚ä¸‹ï¼š

| é¡¹ç›® | é‡‘é¢ |
|------|------|
| æœåŠ¡æ”¶å…¥ | 600å…ƒï¼ˆ2ç¬”ç§æ•™è¯¾ï¼‰ |
| ç§æ•™ææˆ | 240å…ƒ |
| å•†å“é”€å”® | 400å…ƒï¼ˆè›‹ç™½ç²‰ x 2ï¼‰ |
| æ€»æ”¶å…¥ | 1000å…ƒ |
| å‡€åˆ©æ¶¦ | 760å…ƒ |
```

### åœºæ™¯5ï¼šæŸ¥è¯¢ä¼šå‘˜ä¿¡æ¯

**è¾“å…¥ï¼š** "æŸ¥ä¸€ä¸‹æå››çš„ä¼šå‘˜ä¿¡æ¯"

**Agent è¡Œä¸ºï¼š**
- è°ƒç”¨ `query_member_info()` å‡½æ•°
- æŸ¥è¯¢ä¼šå‘˜å¡ã€ä½™é¢ã€æ¶ˆè´¹è®°å½•ç­‰

### åœºæ™¯6ï¼šæŸ¥è¯¢ç§æ•™ææˆ

**è¾“å…¥ï¼š** "ç»Ÿè®¡ä¸€ä¸‹ææ•™ç»ƒä»Šå¤©çš„ææˆ"

**Agent è¡Œä¸ºï¼š**
- è°ƒç”¨ `query_trainer_commission()` å‡½æ•°
- ç»Ÿè®¡ç§æ•™çš„ææˆé‡‘é¢

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### 1. Agent å‡½æ•°æ³¨å†Œ

ä½¿ç”¨ `@agent_callable` è£…é¥°å™¨å°†æ•°æ®åº“æ“ä½œå‡½æ•°æ³¨å†Œä¸ºå¯è¢« Agent è°ƒç”¨çš„å·¥å…·ï¼š

```python
@agent_callable(description="""è®°å½•å¥èº«æˆ¿çš„æœåŠ¡æ”¶å…¥ã€‚
å‚æ•°è¯´æ˜ï¼š
- customer_name: é¡¾å®¢å§“åï¼ˆå¿…å¡«ï¼‰
- service_type: æœåŠ¡ç±»å‹ï¼Œå¦‚"ç§æ•™è¯¾ç¨‹"ã€"å›¢è¯¾"ï¼ˆå¿…å¡«ï¼‰
- amount: æœåŠ¡é‡‘é¢ï¼ˆå¿…å¡«ï¼‰
- trainer_name: ç§æ•™åç§°ï¼ˆå¯é€‰ï¼‰
""")
def record_service_income(
    customer_name: str,
    service_type: str,
    amount: float,
    trainer_name: Optional[str] = None
) -> dict:
    # ... å®ç°
```

### 2. è‡ªåŠ¨ææˆè®¡ç®—

ç§æ•™è¯¾ç¨‹è‡ªåŠ¨è®¡ç®—40%ææˆï¼š

```python
if trainer_name and "ç§æ•™" in service_type:
    commission = amount * 0.4
    net_amount = amount - commission
```

### 3. ç§¯åˆ†ç³»ç»Ÿ

ä¼šå‘˜å¡å……å€¼è‡ªåŠ¨è®¡ç®—ç§¯åˆ†ï¼ˆæ¯10å…ƒ1ç§¯åˆ†ï¼‰ï¼š

```python
membership.points = int(amount / 10)
```

### 4. Interleaved Thinking

MiniMax æ¨¡å‹æ”¯æŒå±•ç¤ºæ€è€ƒè¿‡ç¨‹ï¼š

```python
if 'metadata' in response and response.get('metadata', {}).get('thinking'):
    thinking = response['metadata']['thinking']
    print(f"ğŸ’­ æ€è€ƒè¿‡ç¨‹: {thinking}")
```

## ğŸ“Š æ•°æ®åº“è®¾è®¡

### æœåŠ¡è®°å½•è¡¨ (service_records)

```
- customer_id: é¡¾å®¢ID
- employee_id: å‘˜å·¥IDï¼ˆç§æ•™ï¼‰
- service_type_id: æœåŠ¡ç±»å‹ID
- amount: æœåŠ¡é‡‘é¢
- commission_amount: ææˆé‡‘é¢
- net_amount: å‡€æ”¶å…¥
- service_date: æœåŠ¡æ—¥æœŸ
```

### ä¼šå‘˜å¡è¡¨ (memberships)

```
- customer_id: é¡¾å®¢ID
- card_type: å¡ç±»å‹ï¼ˆå¹´å¡ã€å­£å¡ã€æœˆå¡ï¼‰
- total_amount: æ€»é‡‘é¢
- balance: ä½™é¢
- points: ç§¯åˆ†
- opened_at: å¼€å¡æ—¥æœŸ
- expires_at: åˆ°æœŸæ—¥æœŸ
```

### å•†å“é”€å”®è¡¨ (product_sales)

```
- product_id: å•†å“ID
- customer_id: é¡¾å®¢ID
- quantity: æ•°é‡
- unit_price: å•ä»·
- total_amount: æ€»é‡‘é¢
- sale_date: é”€å”®æ—¥æœŸ
```

## ğŸ¯ æ‰©å±•å»ºè®®

### 1. æ·»åŠ æ›´å¤šåŠŸèƒ½

- é¢„çº¦ç®¡ç†
- åº“å­˜ç®¡ç†
- å‘˜å·¥æ’ç­
- è´¢åŠ¡æŠ¥è¡¨
- è¥é”€æ´»åŠ¨

### 2. å¤šè½®å¯¹è¯æ”¯æŒ

å½“å‰æ¯ä¸ªåœºæ™¯ç‹¬ç«‹è¿è¡Œï¼Œå¯ä»¥ä¿®æ”¹ä¸ºæ”¯æŒå¤šè½®å¯¹è¯ï¼š

```python
# ä¸æ¸…é™¤å†å²ï¼Œä¿æŒä¸Šä¸‹æ–‡
# agent.clear_history()  # æ³¨é‡Šæ‰è¿™è¡Œ

response = await agent.chat(user_input, temperature=0.1)
```

### 3. Web ç•Œé¢

å¯ä»¥åŸºäºæ­¤ç³»ç»Ÿå¼€å‘ Web ç•Œé¢ï¼š

- FastAPI + React
- æ”¯æŒè¯­éŸ³è¾“å…¥
- å®æ—¶æ•°æ®å¯è§†åŒ–
- ç§»åŠ¨ç«¯é€‚é…

### 4. å¤šç”¨æˆ·æ”¯æŒ

- ç”¨æˆ·è®¤è¯
- æƒé™ç®¡ç†
- æ•°æ®éš”ç¦»

## ğŸ“š ç›¸å…³æ–‡ä»¶

- `examples/gym_agent_manager.py` - ä¸»ç¨‹åº
- `tests/agent/test_gym_agent_integration.py` - é›†æˆæµ‹è¯•
- `db/models.py` - æ•°æ®åº“æ¨¡å‹å®šä¹‰
- `db/repository.py` - æ•°æ®åº“æ“ä½œå°è£…

## ğŸ› å¸¸è§é—®é¢˜

### 1. API Key é”™è¯¯

ç¡®ä¿è®¾ç½®äº†æ­£ç¡®çš„ MINIMAX_API_KEY ç¯å¢ƒå˜é‡ã€‚

### 2. æ—¥æœŸæ ¼å¼é”™è¯¯

å‡½æ•°è°ƒç”¨æ—¶æ—¥æœŸåº”è¯¥ä½¿ç”¨ YYYY-MM-DD æ ¼å¼ï¼Œæˆ–è€…ä¸ä¼ ï¼ˆé»˜è®¤ä»Šå¤©ï¼‰ã€‚

### 3. æ•°æ®åº“æ–‡ä»¶ä½ç½®

æ•°æ®åº“æ–‡ä»¶ä¿å­˜åœ¨ `data/gym_agent_example.db`ï¼Œå¯ä»¥ä½¿ç”¨ SQLite å·¥å…·æŸ¥çœ‹ã€‚

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ‘¥ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ™ è‡´è°¢

- MiniMax æä¾›çš„å¼ºå¤§ LLM æ¨¡å‹
- Anthropic SDK çš„å…¼å®¹æ”¯æŒ
- SQLAlchemy çš„ ORM æ¡†æ¶

